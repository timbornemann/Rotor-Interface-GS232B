<!DOCTYPE html>
<html lang="de">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RotorControl GS-232B</title>
  <link rel="stylesheet" href="./styles.css" />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
</head>

<body>
  <header class="top-bar">
    <div class="connection-group">
      <label>
        Port
        <select id="portSelect"></select>
      </label>
      <button id="refreshPortsBtn" class="secondary" type="button" title="Ports aktualisieren">
        <img src="./assets/icons/refresh-ccw.png" alt="Aktualisieren" class="icon">
      </button>
      <button id="connectBtn" class="primary">Verbinden</button>
      <button id="disconnectBtn" disabled>Trennen</button>
    </div>
    <div class="app-title">RotorControl GS-232B</div>
    <button id="settingsBtn" class="secondary" type="button" title="Einstellungen">
      <img src="./assets/icons/settings.png" alt="Einstellungen" class="icon">
    </button>
    <div class="status-line">
      <span id="connectionStatus" class="status-chip disconnected">Getrennt</span>
      <span id="modeStatus">Modus: 360deg</span>
    </div>
  </header>

  <main class="dashboard">
    <section class="card elevation-card">
      <div class="az-values">
        <div class="az-value-item">
          <span>Azimut</span>
          <strong id="azValue">--deg</strong>
        </div>
        <div class="az-value-item">
          <span>Elevation</span>
          <strong id="elValue">--deg</strong>
        </div>
      </div>
      <div id="elevationRoot" class="elevation">
        <svg viewBox="0 30 200 170" class="elevation-svg" id="elevationSvg">
          <g id="elevationScale"></g>
          <g id="elevationIndicator" class="elevation-indicator">
            <line x1="100" y1="180" x2="100" y2="60" stroke="#2fd4ff" stroke-width="3" />
            <polygon points="100,60 95,70 105,70" fill="#ffb347" />
          </g>
        </svg>
      </div>
      
      <!-- Route Manager -->
      <div id="routeManagerRoot" class="route-manager-container"></div>
    </section>

    <section class="card map-card">
      <div class="card-header">
        <h2>Radaransicht</h2>
      </div>
      <div class="map-controls">
        <div class="map-options">
          <label class="checkbox">
            <input id="satelliteMapToggle" type="checkbox" />
            Satellitenkarte anzeigen
          </label>
          <div class="zoom-controls">
            <button id="zoomInBtn" class="secondary" title="Hineinzoomen">
              <img src="./assets/icons/plus.png" alt="Hineinzoomen" class="icon">
            </button>
            <button id="zoomOutBtn" class="secondary" title="Herauszoomen">
              <img src="./assets/icons/minus.png" alt="Herauszoomen" class="icon">
            </button>
            <span id="zoomLevel" class="zoom-level">Zoom: 15</span>
          </div>
        </div>
      </div>
      <div class="canvas-wrapper">
        <canvas id="mapCanvas"></canvas>
      </div>
    </section>

    <div class="right-column">
      <section class="card controls-card">
        <div class="card-header">
          <h2>Rotorsteuerung</h2>
        </div>

        <div class="control-grid" id="controlGrid">
          <button data-command="left">Azimut Links</button>
          <button data-command="stop-azimuth">Azimut Stopp</button>
          <button data-command="right">Azimut Rechts</button>
          <button data-command="down">Elevation Runter</button>
          <button data-command="stop-elevation">Elevation Stopp</button>
          <button data-command="up">Elevation Hoch</button>
          <button data-command="stop" class="danger">Alles Stopp</button>
        </div>

        <div class="preset-controls hidden" id="presetControls">
          <button data-command="home" class="secondary">Home</button>
          <button data-command="park" class="secondary">Park</button>
        </div>


        <div class="goto-form">
          <label>
            Ziel-Azimut (deg)
            <input id="gotoAzInput" type="number" min="0" max="450" step="1" value="0" />
          </label>
          <label>
            Ziel-Elevation (deg)
            <input id="gotoElInput" type="number" min="0" max="90" step="1" value="0" />
          </label>
          <div class="goto-buttons">
            <button id="gotoAzBtn" class="primary">Goto Azimut</button>
            <button id="gotoAzElBtn">Goto Az/El</button>
          </div>
        </div>

        <div class="route-hint hidden" id="routeHint"></div>

        <div class="notice hidden" id="limitWarning"></div>
        <div class="notice hidden" id="speedWarning"></div>

        <div class="last-status">
          <div class="last-status-label">Letzter Status:</div>
          <div class="last-status-value" id="lastStatusValue">--</div>
        </div>
        <div class="logo-container">
          <img id="mainLogo" src="./assets/logo.png" alt="Logo" class="main-logo" />
        </div>
      </section>

    </div>
  </main>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal hidden">
    <div class="modal-content settings-modal">
      <div class="modal-header">
        <h2>Einstellungen</h2>
        <button id="closeSettingsBtn" class="modal-close" type="button" aria-label="Schließen">×</button>
      </div>
      
      <div class="settings-layout">
        <!-- Sidebar Navigation -->
        <nav class="settings-nav">
          <button class="settings-nav-item active" data-tab="connection">
            <img src="./assets/icons/cable.png" alt="Verbindung" class="nav-icon-img">
            <span class="nav-label">Verbindung</span>
          </button>
          <button class="settings-nav-item" data-tab="display">
            <img src="./assets/icons/monitor.png" alt="Anzeige" class="nav-icon-img">
            <span class="nav-label">Anzeige</span>
          </button>
          <button class="settings-nav-item" data-tab="map">
            <img src="./assets/icons/map.png" alt="Karte" class="nav-icon-img">
            <span class="nav-label">Karte</span>
          </button>
          <button class="settings-nav-item" data-tab="speed">
            <img src="./assets/icons/zap.png" alt="Geschwindigkeit" class="nav-icon-img">
            <span class="nav-label">Geschwindigkeit</span>
          </button>
          <button class="settings-nav-item" data-tab="ramp">
            <img src="./assets/icons/chart-spline.png" alt="Rampe" class="nav-icon-img">
            <span class="nav-label">Rampe</span>
          </button>
          <button class="settings-nav-item" data-tab="calibration">
            <img src="./assets/icons/gauge.png" alt="Kalibrierung" class="nav-icon-img">
            <span class="nav-label">Kalibrierung</span>
          </button>
          <button class="settings-nav-item" data-tab="clients">
            <img src="./assets/icons/users.png" alt="Clients" class="nav-icon-img">
            <span class="nav-label">Clients</span>
          </button>
          <button class="settings-nav-item" data-tab="server">
            <img src="./assets/icons/server.png" alt="Server" class="nav-icon-img">
            <span class="nav-label">Server</span>
          </button>
        </nav>

        <!-- Settings Content -->
        <div class="settings-content">
          <!-- Connection Tab -->
          <section class="settings-section active" id="tab-connection">
            <h3 class="section-title">Verbindungseinstellungen</h3>
            
            <div class="settings-card">
              <h4 class="card-title">Serieller Port</h4>
              <div class="form-group">
                <label for="settingsPortSelect">COM-Port</label>
                <div class="input-with-action">
                  <select id="settingsPortSelect"></select>
                  <button id="settingsRefreshPortsBtn" class="icon-btn" type="button" title="Ports aktualisieren">
                    <img src="./assets/icons/refresh-ccw.png" alt="Aktualisieren" class="icon">
                  </button>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="settingsBaudInput">Baudrate</label>
                  <select id="settingsBaudInput">
                    <option value="4800">4800</option>
                    <option value="9600" selected>9600</option>
                    <option value="19200">19200</option>
                    <option value="38400">38400</option>
                    <option value="57600">57600</option>
                    <option value="115200">115200</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="settingsPollingInput">Polling-Intervall</label>
                  <div class="input-unit">
                    <input id="settingsPollingInput" type="number" min="250" max="5000" step="250" value="1000" />
                    <span class="unit">ms</span>
                  </div>
                </div>
              </div>
            </div>

          </section>

          <!-- Display Tab -->
          <section class="settings-section" id="tab-display">
            <h3 class="section-title">Anzeigeeinstellungen</h3>
            
            <div class="settings-card">
              <h4 class="card-title">Rotor-Modus</h4>
              <div class="form-group">
                <label for="settingsModeSelect">Azimut-Bereich</label>
                <select id="settingsModeSelect">
                  <option value="360">360° (Standard)</option>
                  <option value="450">450° (Erweitert)</option>
                </select>
                <p class="help-text">450° ermöglicht Überlappung für kontinuierliche Verfolgung.</p>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">Kegel-Visualisierung</h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="settingsConeAngleInput">Öffnungswinkel</label>
                  <div class="input-unit">
                    <input id="settingsConeAngleInput" type="number" min="1" max="90" step="1" value="10" />
                    <span class="unit">°</span>
                  </div>
                </div>
                <div class="form-group">
                  <label for="settingsConeLengthInput">Kegel-Reichweite</label>
                  <div class="input-unit">
                    <input id="settingsConeLengthInput" type="number" min="0" max="100000" step="10" value="1000" />
                    <span class="unit">m</span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="settingsAzimuthDisplayOffsetInput">Azimut-Korrektur</label>
                <div class="input-unit">
                  <input id="settingsAzimuthDisplayOffsetInput" type="number" min="-180" max="180" step="0.1" value="0" />
                  <span class="unit">°</span>
                </div>
                <p class="help-text">Korrigiert die Ausrichtung der Karte zum wahren Norden.</p>
              </div>
            </div>
          </section>

          <!-- Map Tab -->
          <section class="settings-section" id="tab-map">
            <h3 class="section-title">Karteneinstellungen</h3>
            
            <div class="settings-card">
              <h4 class="card-title">Standort</h4>
              <div class="form-group">
                <label for="settingsMapCoordinatesInput">Koordinaten (Lat, Lon)</label>
                <input id="settingsMapCoordinatesInput" type="text" 
                  placeholder="z.B. 51.8591, 11.4223" />
                <p class="help-text">GPS-Koordinaten des Antennenstandorts.</p>
              </div>
              <div class="form-group">
                <label for="settingsMapSearchInput">Adresse oder Ortsname</label>
                <div class="map-search-row">
                  <input id="settingsMapSearchInput" type="text" placeholder="z.B. Berlin Alexanderplatz" />
                  <button id="settingsMapSearchBtn" class="secondary" type="button">Suchen</button>
                </div>
                <p class="help-text">Alternative zur manuellen Eingabe: Suche nach Adresse/Ort und setze den Punkt per Drag & Drop.</p>
              </div>
              <div id="settingsMapSearchStatus" class="map-search-status hidden" aria-live="polite"></div>
              <div id="settingsMapSearchResults" class="map-search-results hidden"></div>
              <div class="settings-map-picker">
                <div id="settingsMapPicker" class="map-picker-canvas"></div>
                <div class="map-picker-overlay">Auf die Karte klicken, um den Standort zu setzen.</div>
              </div>
              <div class="form-group">
                <label class="toggle-label">
                  <input id="settingsSatelliteMapToggle" type="checkbox" class="toggle-input" />
                  <span class="toggle-switch"></span>
                  <span class="toggle-text">Satellitenkarte anzeigen</span>
                </label>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">Zoom</h4>
              <div class="form-row three-col">
                <div class="form-group">
                  <label for="settingsMapZoomLevel">Standard-Zoom</label>
                  <input id="settingsMapZoomLevel" type="number" min="1" max="25" step="1" value="15" />
                </div>
                <div class="form-group">
                  <label for="settingsMapZoomMin">Minimum</label>
                  <input id="settingsMapZoomMin" type="number" min="1" max="25" step="1" value="5" />
                </div>
                <div class="form-group">
                  <label for="settingsMapZoomMax">Maximum</label>
                  <input id="settingsMapZoomMax" type="number" min="1" max="25" step="1" value="25" />
                </div>
              </div>
            </div>
          </section>

          <!-- Speed Tab -->
          <section class="settings-section" id="tab-speed">
            <h3 class="section-title">Geschwindigkeitseinstellungen</h3>
            
            <div class="settings-card">
              <h4 class="card-title">Drehgeschwindigkeit</h4>
              <div class="form-group">
                <label for="settingsAzSpeedInput">Azimut-Geschwindigkeit</label>
                <div class="range-with-value">
                  <input id="settingsAzSpeedRange" type="range" min="0.5" max="20" step="0.5" value="4" />
                  <div class="input-unit compact">
                    <input id="settingsAzSpeedInput" type="number" min="0.5" max="20" step="0.5" value="4" />
                    <span class="unit">°/s</span>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="settingsElSpeedInput">Elevations-Geschwindigkeit</label>
                <div class="range-with-value">
                  <input id="settingsElSpeedRange" type="range" min="0.5" max="20" step="0.5" value="2" />
                  <div class="input-unit compact">
                    <input id="settingsElSpeedInput" type="number" min="0.5" max="20" step="0.5" value="2" />
                    <span class="unit">°/s</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">ERC-DUO Stufen</h4>
              <div class="speed-stages-grid">
                <div class="speed-stage-column">
                  <h5>Azimut</h5>
                  <div class="form-group">
                    <label for="settingsAzLowSpeedSelect">Low-Speed</label>
                    <select id="settingsAzLowSpeedSelect">
                      <option value="1">1 (langsam)</option>
                      <option value="2">2</option>
                      <option value="3" selected>3</option>
                      <option value="4">4 (schnell)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="settingsAzHighSpeedSelect">High-Speed</label>
                    <select id="settingsAzHighSpeedSelect">
                      <option value="1">1 (langsam)</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4" selected>4 (schnell)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="settingsAzSpeedAngleSelect">Speed-Angle</label>
                    <select id="settingsAzSpeedAngleSelect">
                      <option value="0">0 (0°)</option>
                      <option value="1">1 (10°)</option>
                      <option value="2">2 (20°)</option>
                      <option value="3" selected>3 (30°)</option>
                    </select>
                  </div>
                </div>
                <div class="speed-stage-column">
                  <h5>Elevation</h5>
                  <div class="form-group">
                    <label for="settingsElLowSpeedSelect">Low-Speed</label>
                    <select id="settingsElLowSpeedSelect">
                      <option value="1">1 (langsam)</option>
                      <option value="2">2</option>
                      <option value="3" selected>3</option>
                      <option value="4">4 (schnell)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="settingsElHighSpeedSelect">High-Speed</label>
                    <select id="settingsElHighSpeedSelect">
                      <option value="1">1 (langsam)</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4" selected>4 (schnell)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="settingsElSpeedAngleSelect">Speed-Angle</label>
                    <select id="settingsElSpeedAngleSelect">
                      <option value="0">0 (0°)</option>
                      <option value="1">1 (10°)</option>
                      <option value="2">2 (20°)</option>
                      <option value="3" selected>3 (30°)</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Ramp Tab -->
          <section class="settings-section" id="tab-ramp">
            <h3 class="section-title">Softstart/Softstop</h3>
            
            <div class="settings-card">
              <div class="card-header-with-toggle">
                <h4 class="card-title">PI-Regler</h4>
                <label class="toggle-label compact">
                  <input id="settingsRampEnabledToggle" type="checkbox" class="toggle-input" />
                  <span class="toggle-switch"></span>
                </label>
              </div>
              <p class="help-text">Aktiviert sanftes Anfahren und Abbremsen des Rotors.</p>
              
              <div class="ramp-settings">
                <div class="form-row">
                  <div class="form-group">
                    <label for="settingsRampKpInput">Verstärkung (Kp)</label>
                    <input id="settingsRampKpInput" type="number" min="0" max="5" step="0.01" value="0.4" />
                    <p class="help-text">Reaktionsgeschwindigkeit</p>
                  </div>
                  <div class="form-group">
                    <label for="settingsRampKiInput">Integrator (Ki)</label>
                    <input id="settingsRampKiInput" type="number" min="0" max="5" step="0.01" value="0.05" />
                    <p class="help-text">Restfehler-Korrektur</p>
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="settingsRampSampleInput">Abtastzeit</label>
                    <div class="input-unit">
                      <input id="settingsRampSampleInput" type="number" min="100" max="2000" step="50" value="400" />
                      <span class="unit">ms</span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="settingsRampMaxStepInput">Max. Schritt</label>
                    <div class="input-unit">
                      <input id="settingsRampMaxStepInput" type="number" min="0.1" max="45" step="0.1" value="8" />
                      <span class="unit">°</span>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="settingsRampToleranceInput">Toleranz</label>
                    <div class="input-unit">
                      <input id="settingsRampToleranceInput" type="number" min="0.1" max="10" step="0.1" value="1.5" />
                      <span class="unit">°</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Calibration Tab -->
          <section class="settings-section" id="tab-calibration">
            <h3 class="section-title">Kalibrierung</h3>
            
            <div class="settings-card">
              <h4 class="card-title">Positions-Offsets</h4>
              <p class="help-text">Korrigiert Abweichungen zwischen Anzeige und tatsächlicher Position.</p>
              <div class="form-row">
                <div class="form-group">
                  <label for="settingsAzOffsetInput">Azimut-Offset</label>
                  <div class="input-unit">
                    <input id="settingsAzOffsetInput" type="number" step="0.1" value="0" />
                    <span class="unit">°</span>
                  </div>
                </div>
                <div class="form-group">
                  <label for="settingsElOffsetInput">Elevation-Offset</label>
                  <div class="input-unit">
                    <input id="settingsElOffsetInput" type="number" step="0.1" value="0" />
                    <span class="unit">°</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">Skalierungsfaktoren</h4>
              <p class="help-text">Korrigiert mechanische Übersetzungsverhältnisse. Wert &lt; 1 wenn Motor zu weit dreht.</p>
              <div class="form-row">
                <div class="form-group">
                  <label for="settingsAzScaleFactorInput">Azimut-Faktor</label>
                  <input id="settingsAzScaleFactorInput" type="number" min="0.1" max="2.0" step="0.01" value="1.0" />
                </div>
                <div class="form-group">
                  <label for="settingsElScaleFactorInput">Elevation-Faktor</label>
                  <input id="settingsElScaleFactorInput" type="number" min="0.1" max="2.0" step="0.01" value="1.0" />
                </div>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">Home/Park Presets</h4>
              <p class="help-text">Feste Positionen für Home und Park (Raw-Hardwarewerte).</p>
              <div class="form-row">
                <label class="toggle-label">
                  <input id="settingsParkPositionsEnabled" type="checkbox" class="toggle-input" />
                  <span class="toggle-switch"></span>
                  <span class="toggle-text">Presets aktivieren</span>
                </label>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="settingsHomeAzInput">Home Azimut (Raw)</label>
                  <input id="settingsHomeAzInput" type="number" min="0" max="450" step="1" value="0" />
                </div>
                <div class="form-group">
                  <label for="settingsHomeElInput">Home Elevation (Raw)</label>
                  <input id="settingsHomeElInput" type="number" min="0" max="90" step="1" value="0" />
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="settingsParkAzInput">Park Azimut (Raw)</label>
                  <input id="settingsParkAzInput" type="number" min="0" max="450" step="1" value="0" />
                </div>
                <div class="form-group">
                  <label for="settingsParkElInput">Park Elevation (Raw)</label>
                  <input id="settingsParkElInput" type="number" min="0" max="90" step="1" value="0" />
                </div>
              </div>
              <div class="form-row">
                <label class="toggle-label">
                  <input id="settingsAutoParkOnDisconnect" type="checkbox" class="toggle-input" />
                  <span class="toggle-switch"></span>
                  <span class="toggle-text">Auto-Park bei Disconnect</span>
                </label>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">Soft-Limits</h4>
              <p class="help-text">Begrenzt den Bewegungsbereich des Rotors zum Schutz der Hardware.</p>
              <div class="limits-grid">
                <div class="limit-column">
                  <h5>Azimut</h5>
                  <div class="form-row">
                    <div class="form-group">
                      <label for="settingsAzMinLimit">Min</label>
                      <div class="input-unit">
                        <input id="settingsAzMinLimit" type="number" step="1" value="0" />
                        <span class="unit">°</span>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="settingsAzMaxLimit">Max</label>
                      <div class="input-unit">
                        <input id="settingsAzMaxLimit" type="number" step="1" value="450" />
                        <span class="unit">°</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="limit-column">
                  <h5>Elevation</h5>
                  <div class="form-row">
                    <div class="form-group">
                      <label for="settingsElMinLimit">Min</label>
                      <div class="input-unit">
                        <input id="settingsElMinLimit" type="number" step="1" value="0" />
                        <span class="unit">°</span>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="settingsElMaxLimit">Max</label>
                      <div class="input-unit">
                        <input id="settingsElMaxLimit" type="number" step="1" value="90" />
                        <span class="unit">°</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Clients Tab -->
          <section class="settings-section" id="tab-clients">
            <h3 class="section-title">Verbundene Clients</h3>
            
            <div class="settings-card">
              <h4 class="card-title">Aktive Sitzungen</h4>
              <p class="help-text">Übersicht aller verbundenen Clients. Clients können temporär suspendiert werden.</p>
              
              <div class="clients-table-wrapper">
                <table class="clients-table" id="clientsTable">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>IP-Adresse</th>
                      <th>Browser</th>
                      <th>Verbunden seit</th>
                      <th>Status</th>
                      <th>Aktion</th>
                    </tr>
                  </thead>
                  <tbody id="clientsTableBody">
                    <tr class="empty-row">
                      <td colspan="6">Keine Clients verbunden</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <div class="clients-info">
                <p class="help-text">
                  <strong>Hinweis:</strong> Suspendierte Clients können keine API-Anfragen mehr senden. 
                  Beim Neuladen der Seite erhält der Client eine neue Sitzung und kann wieder zugreifen.
                </p>
              </div>
            </div>
            
            <div class="settings-card">
              <h4 class="card-title">Ihre Sitzung</h4>
              <div class="own-session-info">
                <div class="session-detail">
                  <span class="label">Session-ID:</span>
                  <code id="ownSessionId">--</code>
                </div>
                <div class="session-detail">
                  <span class="label">Status:</span>
                  <span id="ownSessionStatus" class="status-badge active">Aktiv</span>
                </div>
              </div>
            </div>
          </section>

          <!-- Server Tab -->
          <section class="settings-section" id="tab-server">
            <h3 class="section-title">Server-Einstellungen</h3>
            
            <div class="settings-card">
              <h4 class="card-title">Server-Ports</h4>
              <p class="help-text">⚠️ Änderungen erfordern einen Server-Neustart</p>
              <div class="form-row">
                <div class="form-group">
                  <label for="settingsServerHttpPort">HTTP-Port</label>
                  <input id="settingsServerHttpPort" type="number" min="1024" max="65535" value="8081" />
                </div>
                <div class="form-group">
                  <label for="settingsServerWebSocketPort">WebSocket-Port</label>
                  <input id="settingsServerWebSocketPort" type="number" min="1024" max="65535" value="8082" />
                </div>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">Polling & Performance</h4>
              <div class="form-group">
                <label for="settingsServerPollingInterval">Status-Polling-Rate (C2-Befehl)</label>
                <div class="input-unit">
                  <input id="settingsServerPollingInterval" type="number" min="250" max="2000" step="50" value="500" />
                  <span class="unit">ms</span>
                </div>
                <p class="help-text">Wie oft der Server den Rotor-Status abfragt (empfohlen: 500ms)</p>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">Client-Verwaltung</h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="settingsServerMaxClients">Max. Clients</label>
                  <input id="settingsServerMaxClients" type="number" min="1" max="100" value="10" />
                </div>
                <div class="form-group">
                  <label for="settingsServerSessionTimeout">Session-Timeout</label>
                  <div class="input-unit">
                    <input id="settingsServerSessionTimeout" type="number" min="60" max="3600" step="60" value="300" />
                    <span class="unit">s</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">Logging</h4>
              <div class="form-group">
                <label for="settingsServerLoggingLevel">Log-Level</label>
                <select id="settingsServerLoggingLevel">
                  <option value="DEBUG">DEBUG (sehr detailliert)</option>
                  <option value="INFO" selected>INFO (normal)</option>
                  <option value="WARNING">WARNING (nur Warnungen)</option>
                  <option value="ERROR">ERROR (nur Fehler)</option>
                </select>
              </div>
            </div>

            <div class="settings-card">
              <h4 class="card-title">Server-Steuerung</h4>
              <p class="help-text">Startet den Server neu und wendet alle Änderungen an.</p>
              <button id="restartServerBtn" class="primary" type="button">Server neu starten</button>
              <div id="restartStatus" class="notice hidden"></div>
            </div>
          </section>
        </div>
      </div>

      <div class="modal-footer">
        <button id="settingsCancelBtn" class="btn-secondary" type="button">Abbrechen</button>
        <button id="settingsSaveBtn" class="btn-primary" type="button">Speichern</button>
      </div>
    </div>
  </div>

  <!-- Alert Modal -->
  <div id="alertModal" class="modal hidden">
    <div class="modal-content alert-modal">
      <div class="modal-header">
        <h2 id="alertTitle">Hinweis</h2>
      </div>
      <div class="modal-body alert-body">
        <p id="alertMessage"></p>
      </div>
      <div class="modal-footer">
        <button id="alertCancelBtn" class="btn-secondary" type="button" style="display: none;">Abbrechen</button>
        <button id="alertOkBtn" class="btn-primary" type="button">OK</button>
      </div>
    </div>
  </div>

  <!-- Suspension Overlay -->
  <div id="suspensionOverlay" class="suspension-overlay hidden">
    <div class="suspension-content">
      <img src="./assets/icons/shield-ban.png" alt="Suspendiert" class="suspension-icon-img">
      <h2>Sitzung suspendiert</h2>
      <p id="suspensionMessage">Ihre Sitzung wurde von einem Administrator suspendiert.</p>
      <p class="suspension-hint">Laden Sie die Seite neu, um eine neue Sitzung zu starten.</p>
      <button id="suspensionReloadBtn" class="primary" type="button">Seite neu laden</button>
    </div>
  </div>

  <!-- Services zuerst -->
  <script src="./services/configStore.js"></script>
  <script src="./services/websocketService.js"></script>
  <script src="./services/rotorService.js"></script>
  <script src="./services/routeExecutor.js"></script>
  <!-- UI-Komponenten -->
  <script src="./ui/elevation.js"></script>
  <script src="./ui/mapView.js"></script>
  <script src="./ui/historyLog.js"></script>
  <script src="./ui/controls.js"></script>
  <script src="./ui/routeManager.js"></script>
  <script src="./ui/alertModal.js"></script>
  <script src="./ui/settingsModal.js"></script>
  <!-- Hauptlogik zuletzt -->
  <script src="./main.js"></script>
</body>

</html>
